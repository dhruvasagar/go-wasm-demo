<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ WebAssembly in Go: Bridging Web and Backend</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 40px;
            font-weight: 300;
        }
        .section {
            margin: 30px 0;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            border: 1px solid #e8ecf4;
        }
        .section h2 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .demo-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        .demo-panel h3 {
            margin-top: 0;
            color: #495057;
        }
        .form-group {
            margin: 15px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(52, 152, 219, 0.3);
        }
        button.server {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        button.server:hover {
            box-shadow: 0 8px 15px rgba(231, 76, 60, 0.3);
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }
        .results.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .results.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .results.info {
            background: #cce7ff;
            border: 1px solid #99d5ff;
            color: #004085;
        }
        .benchmark-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .benchmark-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        .performance-comparison {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .performance-bar {
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }
        .performance-fill {
            height: 100%;
            border-radius: 15px;
            transition: width 0.5s ease;
        }
        .performance-fill.wasm {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        .performance-fill.js {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        .performance-label {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: 600;
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .highlight strong {
            color: #856404;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            margin: 2px;
        }
        .badge.wasm { background: #27ae60; }
        .badge.server { background: #e74c3c; }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }
        .feature-card h4 {
            margin-top: 0;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ WebAssembly in Go: Bridging Web and Backend</h1>
        <p class="subtitle">Experience the power of shared business logic between frontend and backend</p>
        
        <div class="highlight">
            <strong>üéØ Key Demonstration:</strong> The exact same Go code that validates data, calculates prices, and processes orders on your server runs seamlessly in your browser via WebAssembly. Write once, deploy everywhere!
        </div>

        <div class="section">
            <h2>üèóÔ∏è Shared Business Logic Demo</h2>
            <p>These forms demonstrate <strong>identical business logic</strong> running both client-side (WebAssembly) and server-side (HTTP API). The same Go functions validate your input in both environments!</p>
            
            <div class="demo-grid">
                <div class="demo-panel">
                    <h3>üë§ User Validation</h3>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="userEmail" placeholder="user@example.com">
                    </div>
                    <div class="form-group">
                        <label>Name:</label>
                        <input type="text" id="userName" placeholder="John Doe">
                    </div>
                    <div class="form-group">
                        <label>Age:</label>
                        <input type="number" id="userAge" placeholder="25">
                    </div>
                    <div class="form-group">
                        <label>Country:</label>
                        <select id="userCountry">
                            <option value="">Select...</option>
                            <option value="US">United States</option>
                            <option value="CA">Canada</option>
                            <option value="UK">United Kingdom</option>
                            <option value="DE">Germany</option>
                            <option value="FR">France</option>
                            <option value="JP">Japan</option>
                            <option value="AU">Australia</option>
                            <option value="IN">India</option>
                            <option value="BR">Brazil</option>
                            <option value="MX">Mexico</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="userPremium"> Premium Member
                        </label>
                    </div>
                    <button onclick="validateUserWasmButton()">
                        <span class="badge wasm">WASM</span> Validate Client-Side
                    </button>
                    <button class="server" onclick="validateUserServer()">
                        <span class="badge server">API</span> Validate Server-Side
                    </button>
                    <div id="userResults" class="results"></div>
                </div>
                
                <div class="demo-panel">
                    <h3>üì¶ Product Validation</h3>
                    <div class="form-group">
                        <label>Product Name:</label>
                        <input type="text" id="productName" placeholder="Awesome Product">
                    </div>
                    <div class="form-group">
                        <label>Price ($):</label>
                        <input type="number" step="0.01" id="productPrice" placeholder="99.99">
                    </div>
                    <div class="form-group">
                        <label>Category:</label>
                        <select id="productCategory">
                            <option value="">Select...</option>
                            <option value="electronics">Electronics</option>
                            <option value="clothing">Clothing</option>
                            <option value="books">Books</option>
                            <option value="home">Home</option>
                            <option value="sports">Sports</option>
                            <option value="toys">Toys</option>
                            <option value="beauty">Beauty</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Rating (0-5):</label>
                        <input type="number" step="0.1" min="0" max="5" id="productRating" placeholder="4.5">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="productInStock" checked> In Stock
                        </label>
                    </div>
                    <button onclick="validateProductWasmButton()">
                        <span class="badge wasm">WASM</span> Validate Client-Side
                    </button>
                    <button class="server" onclick="validateProductServer()">
                        <span class="badge server">API</span> Validate Server-Side
                    </button>
                    <div id="productResults" class="results"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üßÆ Advanced Business Logic: Order Calculator</h2>
            <p>This demonstrates complex pricing logic with country-specific tax rates, premium discounts, and shipping calculations - all running identically on client and server!</p>
            
            <div class="demo-grid">
                <div class="demo-panel">
                    <h3>üõí Order Details</h3>
                    <div class="form-group">
                        <label>Products in Cart:</label>
                        <textarea id="orderProducts" rows="4" placeholder='[{"id":1,"name":"Laptop","price":999.99,"category":"electronics"}]'>
[
  {"id": 1, "name": "Wireless Headphones", "price": 99.99, "category": "electronics"},
  {"id": 2, "name": "Cotton T-Shirt", "price": 24.99, "category": "clothing"}
]</textarea>
                    </div>
                    <div class="form-group">
                        <label>Quantities:</label>
                        <input type="text" id="orderQuantities" placeholder="[1, 2]" value="[1, 2]">
                    </div>
                    <button onclick="calculateOrderWasmButton()">
                        <span class="badge wasm">WASM</span> Calculate Client-Side
                    </button>
                    <button class="server" onclick="calculateOrderServer()">
                        <span class="badge server">API</span> Calculate Server-Side
                    </button>
                    <div id="orderResults" class="results"></div>
                </div>
                
                <div class="demo-panel">
                    <h3>üéØ Product Recommendations</h3>
                    <p>Advanced recommendation algorithm using user demographics and purchase patterns:</p>
                    <button onclick="getRecommendationsWasmButton()">
                        <span class="badge wasm">WASM</span> Get Recommendations (Client)
                    </button>
                    <button class="server" onclick="getRecommendationsServer()">
                        <span class="badge server">API</span> Get Recommendations (Server)
                    </button>
                    <div id="recommendationResults" class="results"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>‚ö° Performance Benchmarks: JavaScript vs WASM vs Concurrent WASM</h2>
            <p>Compare the performance of complex algorithms across three implementations:</p>
            <div class="highlight">
                <strong>üéØ Three-Way Comparison:</strong><br>
                ‚Ä¢ <span class="badge" style="background: #f39c12;">JavaScript</span> - Optimized JS implementation<br>
                ‚Ä¢ <span class="badge" style="background: #3498db;">WASM Single</span> - Single-threaded WebAssembly<br>
                ‚Ä¢ <span class="badge" style="background: #27ae60;">WASM Concurrent</span> - Multi-threaded WebAssembly with Go routines
            </div>
            
            <div class="benchmark-section">
                <div class="benchmark-card">
                    <h4>üî¢ Matrix Multiplication</h4>
                    <p>Intensive mathematical computation showcasing concurrency benefits</p>
                    <div class="form-group">
                        <label>Matrix Size:</label>
                        <select id="matrixSize">
                            <option value="50">50x50 (Quick)</option>
                            <option value="100" selected>100x100 (Medium)</option>
                            <option value="200">200x200 (Large)</option>
                            <option value="300">300x300 (Extra Large)</option>
                        </select>
                    </div>
                    <button onclick="benchmarkMatrixComprehensive()">üöÄ Run 3-Way Benchmark</button>
                    <div id="matrixResults" class="results"></div>
                    <div class="performance-comparison" id="matrixComparison"></div>
                </div>
                
                <div class="benchmark-card">
                    <h4>üé® Mandelbrot Set Generation</h4>
                    <p>Parallel-friendly fractal computation ideal for concurrency</p>
                    <div class="form-group">
                        <label>Resolution:</label>
                        <select id="mandelbrotSize">
                            <option value="400,300">400x300 (Quick)</option>
                            <option value="800,600" selected>800x600 (Medium)</option>
                            <option value="1200,900">1200x900 (Large)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Max Iterations:</label>
                        <select id="mandelbrotIterations">
                            <option value="100">100 (Fast)</option>
                            <option value="200" selected>200 (Standard)</option>
                            <option value="300">300 (High Quality)</option>
                        </select>
                    </div>
                    <button onclick="benchmarkMandelbrotComprehensive()">üöÄ Run 3-Way Benchmark</button>
                    <div id="mandelbrotResults" class="results"></div>
                    <div class="performance-comparison" id="mandelbrotComparison"></div>
                </div>
                
                <div class="benchmark-card">
                    <h4>üîê Hash Computation</h4>
                    <p>Parallel batch processing demonstration</p>
                    <div class="form-group">
                        <label>Iterations:</label>
                        <select id="hashCount">
                            <option value="1000">1,000 (Quick)</option>
                            <option value="10000" selected>10,000 (Medium)</option>
                            <option value="50000">50,000 (Large)</option>
                            <option value="100000">100,000 (Stress Test)</option>
                        </select>
                    </div>
                    <button onclick="benchmarkHashComprehensive()">üöÄ Run 3-Way Benchmark</button>
                    <div id="hashResults" class="results"></div>
                    <div class="performance-comparison" id="hashComparison"></div>
                </div>

                <div class="benchmark-card">
                    <h4>üé≠ Ray Tracing (Bonus)</h4>
                    <p>Graphics rendering with concurrent tile processing</p>
                    <div class="form-group">
                        <label>Resolution:</label>
                        <select id="rayTracingSize">
                            <option value="200,150">200x150 (Quick)</option>
                            <option value="400,300" selected>400x300 (Medium)</option>
                            <option value="800,600">800x600 (Large)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Samples per Pixel:</label>
                        <select id="rayTracingSamples">
                            <option value="4">4 (Fast)</option>
                            <option value="8" selected>8 (Standard)</option>
                            <option value="16">16 (High Quality)</option>
                        </select>
                    </div>
                    <button onclick="benchmarkRayTracingComprehensive()">üöÄ Run 3-Way Benchmark</button>
                    <div id="rayTracingResults" class="results"></div>
                    <div class="performance-comparison" id="rayTracingComparison"></div>
                </div>
            </div>

            <div class="highlight" style="margin-top: 30px;">
                <strong>üí° Performance Insights:</strong><br>
                ‚Ä¢ <strong>Concurrent WASM</strong> excels with CPU-intensive, parallelizable workloads<br>
                ‚Ä¢ <strong>Single WASM</strong> provides consistent 2-5x speedup over JavaScript<br>
                ‚Ä¢ <strong>JavaScript</strong> remains competitive for small datasets and I/O operations<br>
                ‚Ä¢ The larger the dataset, the more concurrent WASM dominates!
            </div>

            <div class="highlight" style="margin-top: 20px; text-align: center;">
                <p><strong>üöÄ Want more comprehensive performance tests?</strong></p>
                <a href="performance_benchmarks.html" style="display: inline-block; margin-top: 10px; text-decoration: none; background: linear-gradient(45deg, #4CAF50, #45a049); color: white; padding: 12px 24px; border-radius: 8px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                    üìä View Full Performance Benchmark Suite
                </a>
                <p style="margin-top: 10px; color: #666;">Compare JavaScript vs Single-Thread WASM vs Concurrent WASM across all algorithms</p>
            </div>
        </div>

        <div class="section">
            <h2>üéØ Key Benefits Demonstrated</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üìù Single Source of Truth</h4>
                    <p>Business rules defined once in Go, enforced identically on both client and server. No more synchronization issues!</p>
                </div>
                <div class="feature-card">
                    <h4>‚ö° Near-Native Performance</h4>
                    <p>WebAssembly delivers 2-10x performance improvements for computational tasks compared to JavaScript.</p>
                </div>
                <div class="feature-card">
                    <h4>üîí Type Safety</h4>
                    <p>Go's strong typing system prevents runtime errors and ensures consistent behavior across environments.</p>
                </div>
                <div class="feature-card">
                    <h4>üõ†Ô∏è Better Development Experience</h4>
                    <p>Write, test, and debug business logic in Go's excellent development environment, then deploy everywhere.</p>
                </div>
                <div class="feature-card">
                    <h4>üí® Instant User Feedback</h4>
                    <p>Client-side validation provides immediate feedback without server round trips, improving user experience.</p>
                </div>
                <div class="feature-card">
                    <h4>üì± Offline Capability</h4>
                    <p>Critical business logic runs offline in the browser, enabling PWAs and disconnected scenarios.</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üîß How It Works</h2>
            <div class="highlight">
                <p><strong>Compilation Process:</strong></p>
                <ol>
                    <li><code>shared_models.go</code> contains business logic used by both environments</li>
                    <li><code>GOOS=js GOARCH=wasm go build</code> compiles Go to WebAssembly</li>
                    <li><code>go build</code> compiles the same logic for server deployment</li>
                    <li>Both versions use identical validation, calculation, and processing functions</li>
                </ol>
            </div>
        </div>
    </div>

    <script src="wasm_exec.js"></script>
    <script src="benchmarks_optimized.js"></script>
    <script>
        let wasmReady = false;
        
        // Initialize WebAssembly
        const go = new Go();
        WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
            go.run(result.instance);
            wasmReady = true;
            console.log("‚úÖ WebAssembly module loaded and ready!");
        }).catch((err) => {
            console.error("‚ùå Failed to load WebAssembly:", err);
        });

        // Demo data
        const demoProducts = [
            {"id": 1, "name": "Wireless Headphones", "price": 99.99, "category": "electronics", "in_stock": true, "rating": 4.5, "description": "High-quality wireless headphones"},
            {"id": 2, "name": "Cotton T-Shirt", "price": 24.99, "category": "clothing", "in_stock": true, "rating": 4.2, "description": "Comfortable 100% cotton t-shirt"},
            {"id": 3, "name": "Programming Book", "price": 49.99, "category": "books", "in_stock": true, "rating": 4.8, "description": "Learn advanced programming techniques"},
            {"id": 4, "name": "Coffee Mug", "price": 12.99, "category": "home", "in_stock": true, "rating": 4.0, "description": "Ceramic coffee mug"},
            {"id": 5, "name": "Running Shoes", "price": 129.99, "category": "sports", "in_stock": true, "rating": 4.6, "description": "Lightweight running shoes"}
        ];

        // User validation functions
        function validateUserWasmButton() {
            if (!wasmReady) {
                document.getElementById('userResults').className = 'results error';
                document.getElementById('userResults').textContent = 'WebAssembly not ready yet. Please wait...';
                return;
            }

            const user = {
                email: document.getElementById('userEmail').value,
                name: document.getElementById('userName').value,
                age: parseInt(document.getElementById('userAge').value) || 0,
                country: document.getElementById('userCountry').value,
                premium: document.getElementById('userPremium').checked
            };

            try {
                const result = window.validateUserWasm(JSON.stringify(user));
                const parsedResult = (typeof result === 'string') ? JSON.parse(result) : result;
                displayResult('userResults', parsedResult, 'üåê WebAssembly Client-Side Validation');
            } catch (error) {
                displayError('userResults', error);
            }
        }

        function validateUserServer() {
            const user = {
                email: document.getElementById('userEmail').value,
                name: document.getElementById('userName').value,
                age: parseInt(document.getElementById('userAge').value) || 0,
                country: document.getElementById('userCountry').value,
                premium: document.getElementById('userPremium').checked
            };

            fetch('/api/validate-user', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(user)
            })
            .then(response => response.json())
            .then(result => displayResult('userResults', result, 'üñ•Ô∏è Server-Side API Validation'))
            .catch(error => displayError('userResults', error));
        }

        // Product validation functions
        function validateProductWasmButton() {
            if (!wasmReady) {
                document.getElementById('productResults').className = 'results error';
                document.getElementById('productResults').textContent = 'WebAssembly not ready yet. Please wait...';
                return;
            }

            const product = {
                name: document.getElementById('productName').value,
                price: parseFloat(document.getElementById('productPrice').value) || 0,
                category: document.getElementById('productCategory').value,
                rating: parseFloat(document.getElementById('productRating').value) || 0,
                in_stock: document.getElementById('productInStock').checked
            };

            try {
                const result = window.validateProductWasm(JSON.stringify(product));
                const parsedResult = (typeof result === 'string') ? JSON.parse(result) : result;
                displayResult('productResults', parsedResult, 'üåê WebAssembly Client-Side Validation');
            } catch (error) {
                displayError('productResults', error);
            }
        }

        function validateProductServer() {
            const product = {
                name: document.getElementById('productName').value,
                price: parseFloat(document.getElementById('productPrice').value) || 0,
                category: document.getElementById('productCategory').value,
                rating: parseFloat(document.getElementById('productRating').value) || 0,
                in_stock: document.getElementById('productInStock').checked
            };

            fetch('/api/validate-product', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(product)
            })
            .then(response => response.json())
            .then(result => displayResult('productResults', result, 'üñ•Ô∏è Server-Side API Validation'))
            .catch(error => displayError('productResults', error));
        }

        // Order calculation functions
        function calculateOrderWasmButton() {
            if (!wasmReady) {
                document.getElementById('orderResults').className = 'results error';
                document.getElementById('orderResults').textContent = 'WebAssembly not ready yet. Please wait...';
                return;
            }

            try {
                const products = JSON.parse(document.getElementById('orderProducts').value);
                const quantities = JSON.parse(document.getElementById('orderQuantities').value);
                const user = getCurrentUser();
                
                const order = {
                    products: products,
                    quantities: quantities
                };

                const result = window.calculateOrderTotalWasm(JSON.stringify(order), JSON.stringify(user));
                const parsedResult = (typeof result === 'string') ? JSON.parse(result) : result;
                displayOrderResult('orderResults', parsedResult, 'üåê WebAssembly Client-Side Calculation');
            } catch (error) {
                displayError('orderResults', error);
            }
        }

        function calculateOrderServer() {
            try {
                const products = JSON.parse(document.getElementById('orderProducts').value);
                const quantities = JSON.parse(document.getElementById('orderQuantities').value);
                const user = getCurrentUser();
                
                const requestData = {
                    order: {
                        products: products,
                        quantities: quantities
                    },
                    user: user
                };

                fetch('/api/calculate-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                })
                .then(response => response.json())
                .then(result => displayOrderResult('orderResults', result, 'üñ•Ô∏è Server-Side API Calculation'))
                .catch(error => displayError('orderResults', error));
            } catch (error) {
                displayError('orderResults', error);
            }
        }

        // Recommendation functions
        function getRecommendationsWasmButton() {
            if (!wasmReady) {
                document.getElementById('recommendationResults').className = 'results error';
                document.getElementById('recommendationResults').textContent = 'WebAssembly not ready yet. Please wait...';
                return;
            }

            try {
                const user = getCurrentUser();
                const products = demoProducts;
                const order = { products: JSON.parse(document.getElementById('orderProducts').value) };
                
                const result = window.recommendProductsWasm(
                    JSON.stringify(user),
                    JSON.stringify(products),
                    JSON.stringify(order)
                );
                
                const parsedResult = (typeof result === 'string') ? JSON.parse(result) : result;
                displayRecommendations('recommendationResults', parsedResult, 'üåê WebAssembly Client-Side Recommendations');
            } catch (error) {
                displayError('recommendationResults', error);
            }
        }

        function getRecommendationsServer() {
            try {
                const user = getCurrentUser();
                const products = demoProducts;
                const order = { products: JSON.parse(document.getElementById('orderProducts').value) };
                
                const requestData = {
                    user: user,
                    products: products,
                    order: order
                };

                fetch('/api/recommend-products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                })
                .then(response => response.json())
                .then(result => displayRecommendations('recommendationResults', result, 'üñ•Ô∏è Server-Side API Recommendations'))
                .catch(error => displayError('recommendationResults', error));
            } catch (error) {
                displayError('recommendationResults', error);
            }
        }

        // Benchmark functions
        function benchmarkMatrix() {
            const size = parseInt(document.getElementById('matrixSize').value);
            document.getElementById('matrixResults').className = 'results info';
            document.getElementById('matrixResults').textContent = 'Running matrix multiplication benchmark...\n';
            
            // Create test matrices using typed arrays for fair comparison
            const matrixA = new Float64Array(size * size);
            const matrixB = new Float64Array(size * size);
            for (let i = 0; i < size * size; i++) {
                matrixA[i] = i % 10;
                matrixB[i] = (i * 2) % 10;
            }
            
            // JavaScript benchmark (5 runs for average)
            let jsTotalTime = 0;
            for (let run = 0; run < 5; run++) {
                const jsStart = performance.now();
                const jsResult = matrixMultiplyJSOptimized(matrixA, matrixB, size);
                jsTotalTime += performance.now() - jsStart;
            }
            const jsDuration = jsTotalTime / 5;
            
            // WebAssembly benchmark (5 runs for average)
            if (wasmReady) {
                let wasmTotalTime = 0;
                for (let run = 0; run < 5; run++) {
                    const wasmStart = performance.now();
                    const wasmResult = matrixMultiplyWasm(matrixA, matrixB, size);
                    wasmTotalTime += performance.now() - wasmStart;
                }
                const wasmDuration = wasmTotalTime / 5;
                
                const speedup = (jsDuration / wasmDuration).toFixed(1);
                document.getElementById('matrixResults').textContent = 
                    `Matrix Multiplication (${size}x${size})\n` +
                    `JavaScript: ${jsDuration.toFixed(2)}ms (average of 5 runs)\n` +
                    `WebAssembly: ${wasmDuration.toFixed(2)}ms (average of 5 runs)\n` +
                    `Result: ${speedup}x ${speedup >= 1 ? 'faster' : 'slower'} with WebAssembly`;
                    
                displayPerformanceComparison('matrixComparison', jsDuration, wasmDuration);
            }
        }

        function benchmarkMandelbrot() {
            const [width, height] = document.getElementById('mandelbrotSize').value.split(',').map(Number);
            const iterations = parseInt(document.getElementById('mandelbrotIterations').value);
            
            document.getElementById('mandelbrotResults').className = 'results info';
            document.getElementById('mandelbrotResults').textContent = 'Running Mandelbrot set benchmark...\n';
            
            // JavaScript benchmark (5 runs for average)
            let jsTotalTime = 0;
            for (let run = 0; run < 5; run++) {
                const jsStart = performance.now();
                const jsResult = mandelbrotJSOptimized(width, height, -2, 1, -1.5, 1.5, iterations);
                jsTotalTime += performance.now() - jsStart;
            }
            const jsDuration = jsTotalTime / 5;
            
            // WebAssembly benchmark (5 runs for average)
            if (wasmReady) {
                let wasmTotalTime = 0;
                for (let run = 0; run < 5; run++) {
                    const wasmStart = performance.now();
                    const wasmResult = mandelbrotWasm(width, height, -2, 1, -1.5, 1.5, iterations);
                    wasmTotalTime += performance.now() - wasmStart;
                }
                const wasmDuration = wasmTotalTime / 5;
                
                const speedup = (jsDuration / wasmDuration).toFixed(1);
                document.getElementById('mandelbrotResults').textContent = 
                    `Mandelbrot Set (${width}x${height}, ${iterations} iterations)\n` +
                    `JavaScript: ${jsDuration.toFixed(2)}ms (average of 5 runs)\n` +
                    `WebAssembly: ${wasmDuration.toFixed(2)}ms (average of 5 runs)\n` +
                    `Result: ${speedup}x ${speedup >= 1 ? 'faster' : 'slower'} with WebAssembly`;
                    
                displayPerformanceComparison('mandelbrotComparison', jsDuration, wasmDuration);
            }
        }

        function benchmarkHash() {
            const count = parseInt(document.getElementById('hashCount').value);
            document.getElementById('hashResults').className = 'results info';
            document.getElementById('hashResults').textContent = 'Running simple hash benchmark...\n';
            
            const data = "WebAssembly performance test data";
            
            // JavaScript benchmark (5 runs for average)
            let jsTotalTime = 0;
            for (let run = 0; run < 5; run++) {
                const jsStart = performance.now();
                const jsHash = sha256HashJSOptimized(data, count);
                jsTotalTime += performance.now() - jsStart;
            }
            const jsDuration = jsTotalTime / 5;
            
            // WebAssembly benchmark (5 runs for average)
            if (wasmReady) {
                let wasmTotalTime = 0;
                for (let run = 0; run < 5; run++) {
                    const wasmStart = performance.now();
                    const wasmHash = sha256HashWasm(data, count);
                    wasmTotalTime += performance.now() - wasmStart;
                }
                const wasmDuration = wasmTotalTime / 5;
                
                const speedup = (jsDuration / wasmDuration).toFixed(1);
                document.getElementById('hashResults').textContent = 
                    `Simple Hash Function (${count.toLocaleString()} iterations)\n` +
                    `JavaScript: ${jsDuration.toFixed(2)}ms (average of 5 runs)\n` +
                    `WebAssembly: ${wasmDuration.toFixed(2)}ms (average of 5 runs)\n` +
                    `Result: ${speedup}x ${speedup >= 1 ? 'faster' : 'slower'} with WebAssembly`;
                    
                displayPerformanceComparison('hashComparison', jsDuration, wasmDuration);
            }
        }



        // Helper functions
        function getCurrentUser() {
            return {
                email: document.getElementById('userEmail').value || 'demo@example.com',
                name: document.getElementById('userName').value || 'Demo User',
                age: parseInt(document.getElementById('userAge').value) || 30,
                country: document.getElementById('userCountry').value || 'US',
                premium: document.getElementById('userPremium').checked
            };
        }

        function displayResult(elementId, result, title) {
            const element = document.getElementById(elementId);
            const isValid = result.valid;
            
            element.className = `results ${isValid ? 'success' : 'error'}`;
            element.textContent = `${title}\n\n` +
                `Status: ${isValid ? '‚úÖ Valid' : '‚ùå Invalid'}\n` +
                (result.errors && result.errors.length > 0 ? 
                    `Errors:\n${result.errors.map(e => `‚Ä¢ ${e}`).join('\n')}` : 
                    'All validation rules passed!');
        }

        function displayOrderResult(elementId, result, title) {
            const element = document.getElementById(elementId);
            element.className = 'results success';
            element.textContent = `${title}\n\n` +
                `Subtotal: $${result.subtotal.toFixed(2)}\n` +
                `Tax: $${result.tax.toFixed(2)}\n` +
                `Shipping: $${result.shipping.toFixed(2)}\n` +
                `Discount: $${result.discount.toFixed(2)}\n` +
                `Total: $${result.total.toFixed(2)}`;
        }

        function displayRecommendations(elementId, result, title) {
            const element = document.getElementById(elementId);
            element.className = 'results info';
            
            if (Array.isArray(result) && result.length > 0) {
                element.textContent = `${title}\n\nRecommended Products:\n` +
                    result.map(p => `‚Ä¢ ${p.name} - $${p.price} (${p.category})`).join('\n');
            } else {
                element.textContent = `${title}\n\nNo recommendations available.`;
            }
        }

        function displayError(elementId, error) {
            const element = document.getElementById(elementId);
            element.className = 'results error';
            element.textContent = `Error: ${error.message || error}`;
        }

        function displayPerformanceComparison(elementId, jsDuration, wasmDuration) {
            const maxDuration = Math.max(jsDuration, wasmDuration);
            const jsPercent = (jsDuration / maxDuration) * 100;
            const wasmPercent = (wasmDuration / maxDuration) * 100;
            
            const speedupRatio = jsDuration / wasmDuration;
            const isWasmFaster = wasmDuration < jsDuration;
            const winner = isWasmFaster ? 'WebAssembly' : 'JavaScript';
            const speedupText = isWasmFaster ? 
                `${speedupRatio.toFixed(1)}x faster with WebAssembly!` :
                `${(1/speedupRatio).toFixed(1)}x faster with JavaScript (WebAssembly is slower)`;
            const speedupColor = isWasmFaster ? '#27ae60' : '#e74c3c';
            
            document.getElementById(elementId).innerHTML = `
                <div>JavaScript: ${jsDuration.toFixed(2)}ms</div>
                <div class="performance-bar">
                    <div class="performance-fill js" style="width: ${jsPercent}%"></div>
                    <div class="performance-label">JavaScript</div>
                </div>
                <div>WebAssembly: ${wasmDuration.toFixed(2)}ms</div>
                <div class="performance-bar">
                    <div class="performance-fill wasm" style="width: ${wasmPercent}%"></div>
                    <div class="performance-label">WebAssembly</div>
                </div>
                <div style="text-align: center; margin-top: 10px; font-weight: 600; color: ${speedupColor};">
                    Winner: ${winner} - ${speedupText}
                </div>
            `;
        }

        // Comprehensive benchmark functions for 3-way comparison
        function benchmarkMatrixComprehensive() {
            if (!wasmReady) {
                document.getElementById('matrixResults').className = 'results error';
                document.getElementById('matrixResults').textContent = 'WebAssembly not ready yet. Please wait...';
                return;
            }

            const sizeStr = document.getElementById('matrixSize').value;
            const size = parseInt(sizeStr.split('x')[0]);
            
            document.getElementById('matrixResults').className = 'results info';
            document.getElementById('matrixResults').textContent = 'Running comprehensive matrix benchmark...\n';
            document.getElementById('matrixComparison').innerHTML = '';
            
            // Generate random matrices
            const matrixA = new Array(size * size).fill(0).map(() => Math.random());
            const matrixB = new Array(size * size).fill(0).map(() => Math.random());
            
            setTimeout(() => {
                // JavaScript benchmark
                const jsStart = performance.now();
                matrixMultiplyJS(matrixA, matrixB, size);
                const jsTime = performance.now() - jsStart;
                
                // Single-threaded WASM benchmark
                const singleStart = performance.now();
                window.matrixMultiplyWasm(matrixA, matrixB, size);
                const singleTime = performance.now() - singleStart;
                
                // Concurrent WASM benchmark
                const concurrentStart = performance.now();
                window.matrixMultiplyConcurrentWasm(matrixA, matrixB, size);
                const concurrentTime = performance.now() - concurrentStart;
                
                // Display results
                const speedupSingle = (jsTime / singleTime).toFixed(2);
                const speedupConcurrent = (jsTime / concurrentTime).toFixed(2);
                const concurrentVsSingle = (singleTime / concurrentTime).toFixed(2);
                
                document.getElementById('matrixResults').innerHTML = `
                    <strong>Matrix Multiplication (${sizeStr})</strong><br>
                    <span style="color: #f39c12;">JavaScript:</span> ${jsTime.toFixed(2)}ms<br>
                    <span style="color: #3498db;">Single-Thread WASM:</span> ${singleTime.toFixed(2)}ms (${speedupSingle}x vs JS)<br>
                    <span style="color: #27ae60;">Concurrent WASM:</span> ${concurrentTime.toFixed(2)}ms (${speedupConcurrent}x vs JS, ${concurrentVsSingle}x vs Single)
                `;
                
                displayThreeWayComparison('matrixComparison', jsTime, singleTime, concurrentTime);
            }, 10);
        }

        function benchmarkMandelbrotComprehensive() {
            if (!wasmReady) {
                document.getElementById('mandelbrotResults').className = 'results error';
                document.getElementById('mandelbrotResults').textContent = 'WebAssembly not ready yet. Please wait...';
                return;
            }

            const sizeStr = document.getElementById('mandelbrotSize').value;
            const sizeParts = sizeStr.split(',');
            if (sizeParts.length !== 2) {
                document.getElementById('mandelbrotResults').className = 'results error';
                document.getElementById('mandelbrotResults').textContent = 'Invalid size format. Please use format like "800,600"';
                return;
            }
            
            const width = parseInt(sizeParts[0].replace(/\D/g, ''));
            const height = parseInt(sizeParts[1].replace(/\D/g, ''));
            
            if (isNaN(width) || isNaN(height) || width <= 0 || height <= 0) {
                document.getElementById('mandelbrotResults').className = 'results error';
                document.getElementById('mandelbrotResults').textContent = 'Invalid dimensions. Please enter positive numbers.';
                return;
            }
            
            const maxIterStr = document.getElementById('mandelbrotIterations').value;
            const maxIter = parseInt(maxIterStr.replace(/\D/g, ''));
            
            if (isNaN(maxIter) || maxIter <= 0) {
                document.getElementById('mandelbrotResults').className = 'results error';
                document.getElementById('mandelbrotResults').textContent = 'Invalid iteration count. Please enter a positive number.';
                return;
            }
            
            document.getElementById('mandelbrotResults').className = 'results info';
            document.getElementById('mandelbrotResults').textContent = 'Running comprehensive Mandelbrot benchmark...\n';
            document.getElementById('mandelbrotComparison').innerHTML = '';
            
            const xmin = -2.5, xmax = 1.5, ymin = -1.5, ymax = 1.5;
            
            setTimeout(() => {
                // JavaScript benchmark
                const jsStart = performance.now();
                mandelbrotJSOptimized(width, height, xmin, xmax, ymin, ymax, maxIter);
                const jsTime = performance.now() - jsStart;
                
                // Single-threaded WASM benchmark
                const singleStart = performance.now();
                window.mandelbrotWasm(width, height, xmin, xmax, ymin, ymax, maxIter);
                const singleTime = performance.now() - singleStart;
                
                // Concurrent WASM benchmark
                const concurrentStart = performance.now();
                window.mandelbrotConcurrentWasm(width, height, xmin, xmax, ymin, ymax, maxIter);
                const concurrentTime = performance.now() - concurrentStart;
                
                // Display results
                const speedupSingle = (jsTime / singleTime).toFixed(2);
                const speedupConcurrent = (jsTime / concurrentTime).toFixed(2);
                const concurrentVsSingle = (singleTime / concurrentTime).toFixed(2);
                
                document.getElementById('mandelbrotResults').innerHTML = `
                    <strong>Mandelbrot Set (${sizeStr}, ${maxIter} iterations)</strong><br>
                    <span style="color: #f39c12;">JavaScript:</span> ${jsTime.toFixed(2)}ms<br>
                    <span style="color: #3498db;">Single-Thread WASM:</span> ${singleTime.toFixed(2)}ms (${speedupSingle}x vs JS)<br>
                    <span style="color: #27ae60;">Concurrent WASM:</span> ${concurrentTime.toFixed(2)}ms (${speedupConcurrent}x vs JS, ${concurrentVsSingle}x vs Single)
                `;
                
                displayThreeWayComparison('mandelbrotComparison', jsTime, singleTime, concurrentTime);
            }, 10);
        }

        function benchmarkHashComprehensive() {
            if (!wasmReady) {
                document.getElementById('hashResults').className = 'results error';
                document.getElementById('hashResults').textContent = 'WebAssembly not ready yet. Please wait...';
                return;
            }

            const iterations = parseInt(document.getElementById('hashCount').value);
            const data = 'The quick brown fox jumps over the lazy dog. '.repeat(10);
            
            document.getElementById('hashResults').className = 'results info';
            document.getElementById('hashResults').textContent = 'Running comprehensive hash benchmark...\n';
            document.getElementById('hashComparison').innerHTML = '';
            
            setTimeout(() => {
                // JavaScript benchmark
                const jsStart = performance.now();
                hashJS(data, iterations);
                const jsTime = performance.now() - jsStart;
                
                // Single-threaded WASM benchmark
                const singleStart = performance.now();
                window.sha256HashWasm(data, iterations);
                const singleTime = performance.now() - singleStart;
                
                // Concurrent WASM benchmark
                const concurrentStart = performance.now();
                window.sha256HashConcurrentWasm(data, iterations);
                const concurrentTime = performance.now() - concurrentStart;
                
                // Display results
                const speedupSingle = (jsTime / singleTime).toFixed(2);
                const speedupConcurrent = (jsTime / concurrentTime).toFixed(2);
                const concurrentVsSingle = (singleTime / concurrentTime).toFixed(2);
                
                document.getElementById('hashResults').innerHTML = `
                    <strong>Hash Computation (${iterations.toLocaleString()} iterations)</strong><br>
                    <span style="color: #f39c12;">JavaScript:</span> ${jsTime.toFixed(2)}ms<br>
                    <span style="color: #3498db;">Single-Thread WASM:</span> ${singleTime.toFixed(2)}ms (${speedupSingle}x vs JS)<br>
                    <span style="color: #27ae60;">Concurrent WASM:</span> ${concurrentTime.toFixed(2)}ms (${speedupConcurrent}x vs JS, ${concurrentVsSingle}x vs Single)
                `;
                
                displayThreeWayComparison('hashComparison', jsTime, singleTime, concurrentTime);
            }, 10);
        }

        function benchmarkRayTracingComprehensive() {
            if (!wasmReady) {
                document.getElementById('rayTracingResults').className = 'results error';
                document.getElementById('rayTracingResults').textContent = 'WebAssembly not ready yet. Please wait...';
                return;
            }

            const sizeStr = document.getElementById('rayTracingSize').value;
            const sizeParts = sizeStr.split(',');
            if (sizeParts.length !== 2) {
                document.getElementById('rayTracingResults').className = 'results error';
                document.getElementById('rayTracingResults').textContent = 'Invalid size format. Please use format like "400,300"';
                return;
            }
            
            const width = parseInt(sizeParts[0].replace(/\D/g, ''));
            const height = parseInt(sizeParts[1].replace(/\D/g, ''));
            
            if (isNaN(width) || isNaN(height) || width <= 0 || height <= 0) {
                document.getElementById('rayTracingResults').className = 'results error';
                document.getElementById('rayTracingResults').textContent = 'Invalid dimensions. Please enter positive numbers.';
                return;
            }
            
            const samplesStr = document.getElementById('rayTracingSamples').value;
            const samples = parseInt(samplesStr.replace(/\D/g, ''));
            
            if (isNaN(samples) || samples <= 0) {
                document.getElementById('rayTracingResults').className = 'results error';
                document.getElementById('rayTracingResults').textContent = 'Invalid sample count. Please enter a positive number.';
                return;
            }
            
            document.getElementById('rayTracingResults').className = 'results info';
            document.getElementById('rayTracingResults').textContent = 'Running comprehensive ray tracing benchmark...\n';
            document.getElementById('rayTracingComparison').innerHTML = '';
            
            setTimeout(() => {
                // JavaScript benchmark
                const jsStart = performance.now();
                rayTracingJS(width, height, samples);
                const jsTime = performance.now() - jsStart;
                
                // Single-threaded WASM benchmark
                const singleStart = performance.now();
                window.rayTracingWasm(width, height, samples);
                const singleTime = performance.now() - singleStart;
                
                // Concurrent WASM benchmark
                const concurrentStart = performance.now();
                window.rayTracingConcurrentWasm(width, height, samples);
                const concurrentTime = performance.now() - concurrentStart;
                
                // Display results
                const speedupSingle = (jsTime / singleTime).toFixed(2);
                const speedupConcurrent = (jsTime / concurrentTime).toFixed(2);
                const concurrentVsSingle = (singleTime / concurrentTime).toFixed(2);
                
                document.getElementById('rayTracingResults').innerHTML = `
                    <strong>Ray Tracing (${width}x${height}, ${samples} samples)</strong><br>
                    <span style="color: #f39c12;">JavaScript:</span> ${jsTime.toFixed(2)}ms<br>
                    <span style="color: #3498db;">Single-Thread WASM:</span> ${singleTime.toFixed(2)}ms (${speedupSingle}x vs JS)<br>
                    <span style="color: #27ae60;">Concurrent WASM:</span> ${concurrentTime.toFixed(2)}ms (${speedupConcurrent}x vs JS, ${concurrentVsSingle}x vs Single)
                `;
                
                displayThreeWayComparison('rayTracingComparison', jsTime, singleTime, concurrentTime);
            }, 10);
        }

        // Helper function to display three-way comparison
        function displayThreeWayComparison(elementId, jsTime, singleTime, concurrentTime) {
            const maxTime = Math.max(jsTime, singleTime, concurrentTime);
            const jsPercent = (jsTime / maxTime) * 100;
            const singlePercent = (singleTime / maxTime) * 100;
            const concurrentPercent = (concurrentTime / maxTime) * 100;
            
            document.getElementById(elementId).innerHTML = `
                <div class="performance-bar" style="margin: 5px 0;">
                    <div class="performance-fill" style="width: ${jsPercent}%; background: #f39c12;"></div>
                    <div class="performance-label" style="color: #333;">JavaScript</div>
                </div>
                <div class="performance-bar" style="margin: 5px 0;">
                    <div class="performance-fill" style="width: ${singlePercent}%; background: #3498db;"></div>
                    <div class="performance-label" style="color: #333;">Single WASM</div>
                </div>
                <div class="performance-bar" style="margin: 5px 0;">
                    <div class="performance-fill" style="width: ${concurrentPercent}%; background: #27ae60;"></div>
                    <div class="performance-label" style="color: #333;">Concurrent WASM</div>
                </div>
            `;
        }

        // JavaScript implementations for benchmarking
        function matrixMultiplyJS(matrixA, matrixB, size) {
            const result = new Array(size * size);
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    let sum = 0;
                    for (let k = 0; k < size; k++) {
                        sum += matrixA[i * size + k] * matrixB[k * size + j];
                    }
                    result[i * size + j] = sum;
                }
            }
            return result;
        }

        function hashJS(data, iterations) {
            let hash = 0x12345678;
            for (let iter = 0; iter < iterations; iter++) {
                for (let i = 0; i < data.length; i++) {
                    hash = hash * 33 + data.charCodeAt(i);
                    hash = ((hash << 5) | (hash >>> 27)) >>> 0;
                }
            }
            return hash;
        }

        function rayTracingJS(width, height, samples) {
            const result = new Array(width * height * 3);
            
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const nx = (x / width) * 2.0 - 1.0;
                    const ny = (y / height) * 2.0 - 1.0;
                    
                    let r = 0, g = 0, b = 0;
                    
                    for (let s = 0; s < samples; s++) {
                        // Simplified ray tracing logic
                        const t = Math.sqrt(nx * nx + ny * ny);
                        r += Math.min(1, t);
                        g += Math.min(1, t * 0.7);
                        b += Math.min(1, t * 0.5);
                    }
                    
                    const idx = (y * width + x) * 3;
                    result[idx] = r / samples;
                    result[idx + 1] = g / samples;
                    result[idx + 2] = b / samples;
                }
            }
            
            return result;
        }

        // Fill demo data on load
        window.addEventListener('load', () => {
            document.getElementById('userEmail').value = 'john.doe@example.com';
            document.getElementById('userName').value = 'John Doe';
            document.getElementById('userAge').value = '28';
            document.getElementById('userCountry').value = 'US';
            document.getElementById('userPremium').checked = true;
            
            document.getElementById('productName').value = 'Wireless Headphones';
            document.getElementById('productPrice').value = '99.99';
            document.getElementById('productCategory').value = 'electronics';
            document.getElementById('productRating').value = '4.5';
        });
    </script>
</body>
</html>